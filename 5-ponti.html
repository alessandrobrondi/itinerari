<!DOCTYPE html>
<html lang="it">

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Colle del Termine e 5 Ponti</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>

	body{
	font-family:Inter,Arial;
	margin:0;
	background:#e9e6df;
	color:#333;
	}

	.container{
	max-width:1000px;
	margin:auto;
	background:white;
	padding:30px;
	border-radius:12px;
	margin-top:30px;
	box-shadow:0 3px 10px rgba(0,0,0,0.2);
	}

	h1{
	text-align:center;
	margin-bottom:5px;
	}

	.subtitle{
	text-align:center;
	color:#777;
	margin-bottom:25px;
	}

	#map{
	height:450px;
	border-radius:10px;
	margin-bottom:20px;
	}

	.stats{
	display:grid;
	grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
	gap:15px;
	margin-bottom:25px;
	}

	.stat{
	background:#f4f4f4;
	padding:15px;
	border-radius:8px;
	text-align:center;
	}

	.value{
	font-size:22px;
	font-weight:bold;
	}

	.label{
	font-size:13px;
	color:#666;
	}

	#elevationChart{
	width:100%;
	height:220px;
	background:#fafafa;
	border-radius:10px;
	padding:10px;
	}

	.buttons{
	text-align:center;
	margin-top:25px;
	}

	.btn{
	display:inline-block;
	padding:10px 20px;
	margin:5px;
	border-radius:6px;
	text-decoration:none;
	font-weight:bold;
	}

	.download{
	background:#ffcc66;
	color:black;
	}

	.back{
	background:#2e7d32;
	color:white;
	}

</style>

</head>

<body>

	<div class="container">

	<h1>Colle del Termine e Sentiero dei 5 Ponti</h1>

	<div class="subtitle">
		Altare – Montagna – Baraccone – Cadibona
	</div>

	<div id="map"></div>

	<div class="stats">

	<div class="stat">
	<div id="dist" class="value">--</div>
	<div class="label">Distanza</div>
	</div>

	<div class="stat">
	<div id="dplus" class="value">--</div>
	<div class="label">Dislivello +</div>
	</div>

	<div class="stat">
	<div id="dminus" class="value">--</div>
	<div class="label">Dislivello -</div>
	</div>

	<div class="stat">
	<div id="quotaMax" class="value">--</div>
	<div class="label">Quota max</div>
	</div>

	</div>

	<canvas id="elevationChart"></canvas>

	<div class="buttons">

	<a href="Colle_Termine_5_Ponti.gpx" class="btn download">
	⬇️ Scarica GPX
	</a>

	<a href="../itinerari.html" class="btn back">
	← Torna agli itinerari
	</a>

	</div>

	</div>

	<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<script>

	const map = L.map('map');

	L.tileLayer(
	'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
	{ attribution:'© OpenStreetMap' }
	).addTo(map);

	fetch("Colle_Termine_5_Ponti.gpx")

	.then(r=>r.text())

	.then(gpx=>{

	const parser=new DOMParser();
	const xml=parser.parseFromString(gpx,"text/xml");

	const pts=xml.getElementsByTagName("trkpt");

	let latlngs=[];
	let elevations=[];

	for(let i=0;i<pts.length;i++){

	let lat=parseFloat(pts[i].getAttribute("lat"));
	let lon=parseFloat(pts[i].getAttribute("lon"));

	let ele=pts[i].getElementsByTagName("ele")[0];
	let elev=ele?parseFloat(ele.textContent):0;

	latlngs.push([lat,lon]);
	elevations.push(elev);

	}

	const polyline=L.polyline(latlngs,{color:'red'}).addTo(map);

	map.fitBounds(polyline.getBounds());

	/* marker start end */

	L.marker(latlngs[0]).addTo(map).bindPopup("Partenza");

	L.marker(latlngs[latlngs.length-1]).addTo(map).bindPopup("Arrivo");

	/* distanza e dislivelli */

	let dist=0;
	let plus=0;
	let minus=0;
	let max=0;

	function hav(a,b){

	const R=6371;

	const dLat=(b[0]-a[0])*Math.PI/180;
	const dLon=(b[1]-a[1])*Math.PI/180;

	const lat1=a[0]*Math.PI/180;
	const lat2=b[0]*Math.PI/180;

	const x=Math.sin(dLat/2)**2 +
	Math.sin(dLon/2)**2*Math.cos(lat1)*Math.cos(lat2);

	const c=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));

	return R*c;

	}

	for(let i=1;i<latlngs.length;i++){

	dist+=hav(latlngs[i-1],latlngs[i]);

	let diff=elevations[i]-elevations[i-1];

	if(diff>0)plus+=diff;
	else minus+=Math.abs(diff);

	if(elevations[i]>max)max=elevations[i];

	}

	document.getElementById("dist").innerHTML=dist.toFixed(1)+" km";
	document.getElementById("dplus").innerHTML=Math.round(plus)+" m";
	document.getElementById("dminus").innerHTML=Math.round(minus)+" m";
	document.getElementById("quotaMax").innerHTML=Math.round(max)+" m";

	/* grafico */

	new Chart(document.getElementById("elevationChart"),{

	type:"line",

	data:{
	labels:elevations.map((_,i)=>i),
	datasets:[{
	data:elevations,
	fill:true,
	tension:0.1
	}]
	},

	options:{
	plugins:{legend:{display:false}},
	scales:{x:{display:false}}
	}

	});

	});

	</script>

</body>
</html>